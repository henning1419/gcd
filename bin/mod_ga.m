function [y] = mod_ga(x,p)
% get parameters
ce=p(1);
siL=p(2);
siR=p(3);
hi=p(4);
linL=p(5);
linR=p(6);

% split into left and right part with respect to center
x1=x(x<=ce);
x2=x(x>ce);
x1=x1(:);
x2=x2(:);

% calculate model
y=hi*[linL*sL(x1,siL,ce)+(1-linL)*G(x1,siL,ce); linR*sL(x2,siR,ce)+(1-linR)*G(x2,siR,ce)];

end

%% gaussian curve
function r=G(x,si,ce)
r= exp(-(x-ce).^2./(si.^2) ) ;
end

%% linear flank with smoothed ends
function r=sL(x,si,ce)
lenA=200;
if max(x)<=ce
    % get the underlying grid with 200 values
    xbase=linspace(ce-2.5*si,ce,lenA);
    %get pre calculated profile
    rt=rtemp1;
    %initiate r on full grid
    r=zeros(size(x));
    %assign profile to full grid via interpolation
    idxL=find(x>=xbase(1),1,'first');
    r(idxL:end)=interp1(xbase,rt,x(idxL:end),'linear',0); %%% time critical
else
    %analog to first case
    xbase=linspace(ce,ce+2.5*si,lenA);
    rt=rtemp2;
    r=zeros(size(x));
    idxR=find(x<=xbase(end),1,'last');
    r(1:idxR)=interp1(xbase,rt,x(1:idxR),'linear',0); %%% time critical
end
end

%% pre calculated linear flanks (200 values, r in [0,1])
function r=rtemp1
% for reevaluation/same as:

% lenA=200
% bound=floor(0.05*lenA);
% rtemp=[zeros(2*bound,1); linspace(0,1,lenA-3*bound)';ones(bound,1) ];
% r=smooth(rtemp,ceil(0.05*lenA));  %%% time critical
% r=r-min(r);
% r=(1/max(r))*r;

r=[0
    0
    0
    0
    0
    0
    0
    0
    0
    0
    0
    0
    0
    0
    0
    0
    0
    0.0007
    0.0020
    0.0039
    0.0066
    0.0099
    0.0138
    0.0184
    0.0237
    0.0296
    0.0355
    0.0414
    0.0473
    0.0533
    0.0592
    0.0651
    0.0710
    0.0769
    0.0828
    0.0888
    0.0947
    0.1006
    0.1065
    0.1124
    0.1183
    0.1243
    0.1302
    0.1361
    0.1420
    0.1479
    0.1538
    0.1598
    0.1657
    0.1716
    0.1775
    0.1834
    0.1893
    0.1953
    0.2012
    0.2071
    0.2130
    0.2189
    0.2249
    0.2308
    0.2367
    0.2426
    0.2485
    0.2544
    0.2604
    0.2663
    0.2722
    0.2781
    0.2840
    0.2899
    0.2959
    0.3018
    0.3077
    0.3136
    0.3195
    0.3254
    0.3314
    0.3373
    0.3432
    0.3491
    0.3550
    0.3609
    0.3669
    0.3728
    0.3787
    0.3846
    0.3905
    0.3964
    0.4024
    0.4083
    0.4142
    0.4201
    0.4260
    0.4320
    0.4379
    0.4438
    0.4497
    0.4556
    0.4615
    0.4675
    0.4734
    0.4793
    0.4852
    0.4911
    0.4970
    0.5030
    0.5089
    0.5148
    0.5207
    0.5266
    0.5325
    0.5385
    0.5444
    0.5503
    0.5562
    0.5621
    0.5680
    0.5740
    0.5799
    0.5858
    0.5917
    0.5976
    0.6036
    0.6095
    0.6154
    0.6213
    0.6272
    0.6331
    0.6391
    0.6450
    0.6509
    0.6568
    0.6627
    0.6686
    0.6746
    0.6805
    0.6864
    0.6923
    0.6982
    0.7041
    0.7101
    0.7160
    0.7219
    0.7278
    0.7337
    0.7396
    0.7456
    0.7515
    0.7574
    0.7633
    0.7692
    0.7751
    0.7811
    0.7870
    0.7929
    0.7988
    0.8047
    0.8107
    0.8166
    0.8225
    0.8284
    0.8343
    0.8402
    0.8462
    0.8521
    0.8580
    0.8639
    0.8698
    0.8757
    0.8817
    0.8876
    0.8935
    0.8994
    0.9053
    0.9112
    0.9172
    0.9231
    0.9290
    0.9349
    0.9408
    0.9467
    0.9527
    0.9586
    0.9645
    0.9704
    0.9763
    0.9816
    0.9862
    0.9901
    0.9934
    0.9961
    0.9980
    0.9993
    1.0000
    1.0000
    1.0000
    1.0000
    1.0000
    1.0000
    1.0000];
end

function r=rtemp2
r=[1.0000
    1.0000
    1.0000
    1.0000
    1.0000
    1.0000
    1.0000
    0.9994
    0.9981
    0.9963
    0.9938
    0.9907
    0.9870
    0.9826
    0.9777
    0.9721
    0.9665
    0.9609
    0.9553
    0.9497
    0.9441
    0.9385
    0.9330
    0.9274
    0.9218
    0.9162
    0.9106
    0.9050
    0.8994
    0.8939
    0.8883
    0.8827
    0.8771
    0.8715
    0.8659
    0.8603
    0.8547
    0.8492
    0.8436
    0.8380
    0.8324
    0.8268
    0.8212
    0.8156
    0.8101
    0.8045
    0.7989
    0.7933
    0.7877
    0.7821
    0.7765
    0.7709
    0.7654
    0.7598
    0.7542
    0.7486
    0.7430
    0.7374
    0.7318
    0.7263
    0.7207
    0.7151
    0.7095
    0.7039
    0.6983
    0.6927
    0.6872
    0.6816
    0.6760
    0.6704
    0.6648
    0.6592
    0.6536
    0.6480
    0.6425
    0.6369
    0.6313
    0.6257
    0.6201
    0.6145
    0.6089
    0.6034
    0.5978
    0.5922
    0.5866
    0.5810
    0.5754
    0.5698
    0.5642
    0.5587
    0.5531
    0.5475
    0.5419
    0.5363
    0.5307
    0.5251
    0.5196
    0.5140
    0.5084
    0.5028
    0.4972
    0.4916
    0.4860
    0.4804
    0.4749
    0.4693
    0.4637
    0.4581
    0.4525
    0.4469
    0.4413
    0.4358
    0.4302
    0.4246
    0.4190
    0.4134
    0.4078
    0.4022
    0.3966
    0.3911
    0.3855
    0.3799
    0.3743
    0.3687
    0.3631
    0.3575
    0.3520
    0.3464
    0.3408
    0.3352
    0.3296
    0.3240
    0.3184
    0.3128
    0.3073
    0.3017
    0.2961
    0.2905
    0.2849
    0.2793
    0.2737
    0.2682
    0.2626
    0.2570
    0.2514
    0.2458
    0.2402
    0.2346
    0.2291
    0.2235
    0.2179
    0.2123
    0.2067
    0.2011
    0.1955
    0.1899
    0.1844
    0.1788
    0.1732
    0.1676
    0.1620
    0.1564
    0.1508
    0.1453
    0.1397
    0.1341
    0.1285
    0.1229
    0.1173
    0.1117
    0.1061
    0.1006
    0.0950
    0.0894
    0.0838
    0.0782
    0.0726
    0.0670
    0.0615
    0.0559
    0.0503
    0.0447
    0.0391
    0.0335
    0.0279
    0.0223
    0.0174
    0.0130
    0.0093
    0.0062
    0.0037
    0.0019
    0.0006
    0
    0
    0
    0
    0
    0
    0];
end
